<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>kTAMV Server UI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
        }
        h1 {
            margin-top: 20px;
        }
        .button-container {
            margin: 20px;
        }
        button {
            margin: 5px;
            padding: 10px 15px;
            font-size: 16px;
            border-radius: 8px;
            border: none;
            background-color: #3498db;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #2980b9;
        }
        #camera-container {
            position: relative;
            display: inline-block;
        }
        #camera-stream {
            width: 640px;
            height: 480px;
            background-color: black;
        }
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 640px;
            height: 480px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <h1>kTAMV Server UI</h1>

    <div class="button-container">
        <button onclick="startPreview()">Preview Starten</button>
        <button onclick="stopPreview()">Preview Stoppen</button>
        <button onclick="findNozzleCenter()">Find Nozzle Center</button>
        <br><br>
        <button onclick="moveX(-5)">X-</button>
        <button onclick="moveX(5)">X+</button>
        <button onclick="moveY(-5)">Y-</button>
        <button onclick="moveY(5)">Y+</button>
        <button onclick="resetPosition()">Reset Position</button>
        <br><br>
        <button onclick="toggleCrosshair()">Fadenkreuz An/Aus</button>
        <button onclick="increaseLineWidth()">Linienstärke +</button>
        <button onclick="decreaseLineWidth()">Linienstärke -</button>
        <br><br>
        <button onclick="increaseCircleSize()">Kreisgröße +</button>
        <button onclick="decreaseCircleSize()">Kreisgröße -</button>
        <button onclick="changeCrosshairColor()">Farbe ändern</button>
    </div>

    <div id="camera-container">
        <img id="camera-stream" src="http://192.168.178.110/webcam/?action=stream" alt="Camera Stream">
        <canvas id="overlay"></canvas>
    </div>

    <script>
        let showCrosshair = true;
        let crosshairColor = 'red';
        let lineWidth = 2;
        let circleRadius = 20;
        let offsetX = 0;
        let offsetY = 0;

        const overlay = document.getElementById('overlay');
        const ctx = overlay.getContext('2d');

        function drawOverlay() {
            ctx.clearRect(0, 0, overlay.width, overlay.height);

            if (showCrosshair) {
                const centerX = overlay.width / 2 + offsetX;
                const centerY = overlay.height / 2 + offsetY;

                ctx.strokeStyle = crosshairColor;
                ctx.lineWidth = lineWidth;

                // Fadenkreuz
                ctx.beginPath();
                ctx.moveTo(centerX - 20, centerY);
                ctx.lineTo(centerX + 20, centerY);
                ctx.moveTo(centerX, centerY - 20);
                ctx.lineTo(centerX, centerY + 20);
                ctx.stroke();

                // Kreis
                ctx.beginPath();
                ctx.arc(centerX, centerY, circleRadius, 0, 2 * Math.PI);
                ctx.stroke();
            }
        }

        function startPreview() {
            fetch('/start_preview', { method: 'POST' })
                .then(response => response.json())
                .then(data => alert('Preview gestartet!'))
                .catch(error => alert('Fehler beim Starten des Previews'));
        }

        function stopPreview() {
            fetch('/stop_preview', { method: 'POST' })
                .then(response => response.json())
                .then(data => alert('Preview gestoppt!'))
                .catch(error => alert('Fehler beim Stoppen des Previews'));
        }

        function findNozzleCenter() {
            fetch('/find_nozzle_center', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    alert('Nozzle Center gefunden:\nX-Offset: ' + data.x_offset.toFixed(3) + '\nY-Offset: ' + data.y_offset.toFixed(3));
                })
                .catch(error => alert('Fehler beim Finden des Nozzle Centers.'));
        }

        function toggleCrosshair() {
            showCrosshair = !showCrosshair;
            drawOverlay();
        }

        function increaseLineWidth() {
            lineWidth += 1;
            drawOverlay();
        }

        function decreaseLineWidth() {
            if (lineWidth > 1) {
                lineWidth -= 1;
                drawOverlay();
            }
        }

        function increaseCircleSize() {
            circleRadius += 5;
            drawOverlay();
        }

        function decreaseCircleSize() {
            if (circleRadius > 5) {
                circleRadius -= 5;
                drawOverlay();
            }
        }

        function changeCrosshairColor() {
            const colors = ['red', 'green', 'blue', 'yellow', 'white'];
            const currentIndex = colors.indexOf(crosshairColor);
            crosshairColor = colors[(currentIndex + 1) % colors.length];
            drawOverlay();
        }

        function moveX(value) {
            offsetX += value;
            drawOverlay();
        }

        function moveY(value) {
            offsetY += value;
            drawOverlay();
        }

        function resetPosition() {
            offsetX = 0;
            offsetY = 0;
            drawOverlay();
        }

        overlay.width = 640;
        overlay.height = 480;
        drawOverlay();
    </script>
</body>
</html>
